var EditorWrapper=function(){"use strict";CodeMirror.prototype.renderAllDoc=function(e){this.setOption("readOnly",!0);for(var t=this.getViewport(),o=this.lineCount()-1;t.to<o&&t.to>0;)this.scrollIntoView({line:t.to}),t=this.getViewport();this.scrollIntoView({line:o}),this.scrollIntoView({top:e}),this.setOption("readOnly",!1)},CodeMirror.prototype.unfocus=function(){this.getInputField().blur()},CodeMirror.keyMap.default["Shift-Tab"]="indentLess",CodeMirror.keyMap.default.Tab="indentMore";var e=CodeMirror.keyNames,t=CodeMirror.browser.mac;function o(e,t){let o,r=Array.prototype.slice.call(t.attributes);for(;o=r.pop();)e.setAttribute(o.nodeName,o.nodeValue)}var r=function(e){return void 0===e};function n(e,t){return r(e)?t:e}var i=function(){function e(e,t){var o=e.render_plugins||["footnote","katex","mermaid","anchor","task-lists","sup","sub","abbr"],r=-1!=$.inArray("mermaid",o);this.md=createMarkdownParser({html:!1!==e.render_allowHtml,plugins:o,lineNumber:!0,highlight:function(e,t){if(r&&"mermaid"==t)return'<div class="mermaid-block"><div class="mermaid">'+e+'</div><div class="mermaid-source" style="display:none">'+e+"</div></div>";if(t&&hljs.getLanguage(t))try{return'<pre class="hljs"><code>'+hljs.highlight(t,e,!0).value+"</code></pre>"}catch(e){}}});var n=createMarkdownParser({html:!1!==e.render_allowHtml,plugins:o,lineNumber:!1,highlight:function(e,t){if(r&&"mermaid"==t)return'<div class="mermaid">'+e+"</div>"}});this.md2=n,this.config=e,this.theme=t,this.hasMermaid=r,this.hasKatex=-1!=$.inArray("katex",o)}var t=!1;var n=!1;return e.prototype.getHtml=function(e){return this.md2.render(e)},e.prototype.renderAt=function(e,i,a){var c=$.parseHTML2(this.md.render(e));null!=c.querySelector(".mermaid")&&!1!==this.hasMermaid&&function(e,o){if(!t){t=!0,$("<script>").appendTo("body").attr({src:o.res_mermaid_js||"js/mermaid.min.js"});var r=setInterval(function(){try{mermaid.initialize({theme:e.mermaid.theme||"default"}),clearInterval(r);try{mermaid.init({},"#editor_out .mermaid")}catch(e){console.log(e)}}catch(e){}},20)}}(this.theme,this.config),null!=c.querySelector(".katex")&&!1!==this.hasKatex&&function(e){if(!n){n=!0,$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:e.res_katex_css||"katex/katex.min.css"}),$("<script>").appendTo("body").attr({src:e.res_katex_js||"katex/katex.min.js"});var t=setInterval(function(){try{katex.renderToString("",{throwOnError:!1}),clearInterval(t);for(var e=document.getElementById("editor_out").querySelectorAll(".katex"),o=0;o<e.length;o++){var r=e[o];try{r.innerHTML=katex.renderToString(r.textContent,{throwOnError:!1,displayMode:!0})}catch(e){console.log(e)}}}catch(e){}},20)}}(this.config),this.config.render_beforeRender&&this.config.render_beforeRender(c);var l=c.body.innerHTML;if(a){var s=document.createElement("div");o(s,i),s.innerHTML=l,morphdom(i,s,{onBeforeElUpdated:function(e,t){if(e.isEqualNode(t))return!1;if(e.classList.contains("mermaid-block")&&t.classList.contains("mermaid-block")){var n=e.getElementsByClassName("mermaid-source")[0],i=t.getElementsByClassName("mermaid-source")[0];if(r(n)||r(i))return!0;if(n.textContent==i.textContent)return o(e,t),!1}return!0}})}else i.innerHTML=l;var d=!1;try{mermaid.initialize({theme:this.theme.mermaid.theme||"default"}),d=!0,mermaid.init({},"#editor_out .mermaid")}catch(e){d&&console.log(e)}},{create:function(t,o){return new e(t,o)}}}(),a=function(){function e(e,t){this.element=$(e),this.keepHidden=!1}return e.prototype.hide=function(){this.element.css({visibility:"hidden"}),this.hidden=!0},e.prototype.height=function(){return this.element.height()},e.prototype.show=function(){this.keepHidden||(this.element.css({visibility:"visible"}),this.hidden=!1)},e.prototype.addItem=function(e){insertItem(this,e,this.items.length)},e.prototype.getSize=function(){return this.element.find("i").length},e.prototype.insertIcon=function(e,t,o,r){var n=function(e,t){var o=document.createElement("i");return o.setAttribute("class",e),o.setAttribute("style","cursor: pointer;margin-right:20px"),t&&o.addEventListener("click",function(){t(o)}),o}(e,t);r&&r(n);var i=this.element[0];o>=this.getSize()?i.appendChild(n):o<=0?i.insertBefore(n,i.childNodes[0]):i.insertBefore(n,i.childNodes[o])},e.prototype.addIcon=function(e,t,o){this.insertIcon(e,t,this.getSize(),o)},e.prototype.removeIcon=function(e){for(var t=this.element[0].querySelectorAll("i"),o=t.length-1;o>=0;o--){var r=t[o];e(r)&&this.element[0].removeChild(r)}},{create:function(t){return new e(t)}}}(),c=function(e){function t(e,t,o){this.editor=e,this.scrollElement=t,this.config=o}var o=function(e,t){return e.querySelector('[data-line="'+t+'"]')},n=function(e){return e.querySelectorAll("[data-line]")};return t.prototype.doSync=function(){var e=function(e,t){var o=[],i=n(t);i.forEach(function(e){o.push(parseInt(e.getAttribute("data-line")))});var a=e.getScrollInfo().top;let c,l;for(let t=0;t<o.length;t++){const r=o[t];if(!(e.heightAtLine(r,"local")<a)){l=r;break}c=r}!r(c)&&r(l)&&(l=parseInt(i[i.length-1].getAttribute("data-end-line")));let s=0;return r(c)||r(l)||c===l||(s=(a-e.heightAtLine(c,"local"))/(e.heightAtLine(l,"local")-e.heightAtLine(c,"local"))),{lastMarker:c,nextMarker:l,percentage:s}}(this.editor,this.scrollElement);let t=0;var i=$(this.scrollElement);let a=i.outerHeight();var c,l,s,d;r(e.lastMarker)||(c=o(this.scrollElement,e.lastMarker),r(c)||(t=c.offsetTop-10)),r(e.nextMarker)||(l=o(this.scrollElement,e.nextMarker)||(s=this.scrollElement,d=e.nextMarker,s.querySelector('[data-end-line="'+d+'"]')),r(l)||(a=l.offsetTop-10));var u=a-t;r(c)||r(l)||c!==l||(u=c.clientHeight);var h=this.config.sync_animateMs||0;const f=t+u*e.percentage;i.stop(!0),i.animate({scrollTop:f},h)},{create:function(e,o,r){return new t(e,o,r)}}}(),l=function(){function e(e){this.wrapper=e,this.key=e.config.backup_key||"heather-documents";var t=this;e.editor.on("change",function(){t.autoSaveTimer&&clearTimeout(t.autoSaveTimer),t.autoSaveTimer=setTimeout(function(){var o=e.getValue();""!=o&&(t.docName?t.addDocument(t.docName,o):t.addDocument("default",o))},n(e.config.backup_autoSaveMs,500))}),e.onRemove(function(){t.wrapper=null,t.autoSaveTimer&&clearTimeout(t.autoSaveTimer)}),e.eventHandlers.push({name:"load",handler:function(){setTimeout(function(){t.loadLastDocument()},100)}})}function t(e,t){if(null!=t){"default"!=t.title?e.docName=t.title:e.docName=void 0;var o=e.wrapper;o.setValue(t.content),!1!==o.syncEnable&&!1!==o.config.renderAllDocEnable&&o.editor.renderAllDoc(0)}}function o(e,t){for(var o=e.length-1;o>=0;o--)if(e[o].title==t){e.splice(o,1);break}}function r(e,t){var o=JSON.stringify(t);localStorage.setItem(e,o)}return e.prototype.addDocument=function(e,t){var n=this.getDocuments();o(n,e),n.push({title:e,content:t,time:$.now()}),r(this.key,n)},e.prototype.deleteDocument=function(e){var t=this.getDocument(e);null!=t&&this.docName==t.title&&this.newDocument();var n=this.getDocuments();o(n,e),r(this.key,n)},e.prototype.getDocument=function(e){for(var t=this.getDocuments(),o=t.length-1;o>=0;o--)if(t[o].title==e)return t[o];return null},e.prototype.getDocuments=function(){var e=localStorage.getItem(this.key);return null==e?[]:$.parseJSON(e)},e.prototype.getLastDocument=function(){var e=this.getDocuments();return e.sort(function(e,t){var o=e.time,r=t.time;return o>r?-1:o==r?0:1}),e.length>0?e[0]:null},e.prototype.loadLastDocument=function(){t(this,this.getLastDocument())},e.prototype.loadDocument=function(e){t(this,this.getDocument(e))},e.prototype.newDocument=function(){this.docName=void 0,this.wrapper.setValue("")},e.prototype.backup=function(){if(this.docName)this.addDocument(this.docName,this.wrapper.getValue()),this.deleteDocument("default"),swal("保存成功");else{var e=this;!async function(){const{value:t}=await Swal.fire({title:"标题",input:"text",showCancelButton:!0});t&&(e.addDocument(t,e.wrapper.getValue()),e.docName=t,e.deleteDocument("default"),swal("保存成功"))}()}},{create:function(t){return new e(t)}}}(),s=function(){function e(e){this.key=e.theme_key||"heather-theme",this.store={save:function(e,t){localStorage.setItem(e,t)},get:function(e){return localStorage.getItem(e)}},this.config=e,this.timer=void 0}function t(e){this.toolbar={},this.bar={},this.stat={},this.editor={},this.inCss={},this.searchHelper={},this.mermaid={},this.hljs={theme:"github"},this.customCss=void 0,this.timer=void 0,this.config=e}return e.prototype.saveTheme=function(e){this.timer&&clearTimeout(this.timer);var t=this;this.timer=setTimeout(function(){var o=JSON.stringify(e);t.store.save(t.key,o)},500)},e.prototype.reset=function(){var e=new t(this.config);return this.store.save(this.key,JSON.stringify(e)),e.render(),e},e.prototype.getTheme=function(){var e=this.store.get(this.key);if(null==e)return new t(this.config);var o=$.parseJSON(e),r=new t(this.config);return r.toolbar=o.toolbar,r.bar=o.bar,r.stat=o.stat,r.editor=o.editor,r.inCss=o.inCss,r.cursorHelper=o.cursorHelper,r.mermaid=o.mermaid,r.customCss=o.customCss,r},t.prototype.clone=function(){var e=JSON.parse(JSON.stringify(this)),o=new t(this.config);return o.toolbar=e.toolbar,o.bar=e.bar,o.stat=e.stat,o.editor=e.editor,o.inCss=e.inCss,o.searchHelper=e.searchHelper,o.mermaid=e.mermaid,o.customCss=e.customCss,o},t.prototype.render=function(e){(function(e,t){if(e.editor.theme){var o=e.editor.theme,r=e.config.res_editorTheme||function(e){return"codemirror/theme/"+e+".css"};0==$("#codemirror-theme-"+o).length?$('<link id="codemirror-theme-'+o+'" >').appendTo("head").attr({type:"text/css",rel:"stylesheet",onload:function(){t&&t(o)},href:r(o)}):t&&t(o)}})(this,(e=e||{}).editorThemeLoad),function(e){if(e.hljs.theme){var t=e.hljs.theme,o=e.config.res_hljsTheme||function(e){return"highlight/styles/"+e+".css"};0==$("hljs-theme-"+t).length&&$('<link id="hljs-theme-'+t+'" >').appendTo("head").attr({type:"text/css",rel:"stylesheet",href:o(t)})}}(this);var t="";t+="#editor_toolbar{color:"+(this.toolbar.color||"inherit")+"}\n",t+="#editor_innerBar{color:"+(this.bar.color||"inherit")+"}\n",t+="#editor_stat{color:"+(this.stat.color||"inherit")+"}\n",t+="#editor_in{background:"+(this.inCss.background||"inherit")+"}\n";var o=this.searchHelper.color||"inherit";t+="#editor_searchHelper{color:"+o+"}\n#editor_searchHelper .form-control{color:"+o+"}\n#editor_searchHelper .input-group-text{color:"+o+"}\n#editor_searchHelper .form-control::placeholder {color: "+o+";opacity: 1;}\n#editor_searchHelper .form-control::-ms-input-placeholder {color: "+o+";}\n#editor_searchHelper .form-control::-ms-input-placeholder {color: "+o+";}",$("#custom_theme").remove(),""!=$.trim(t)&&$("head").append("<style type='text/css' id='custom_theme'>"+t+"</style>"),$("#custom_css").remove(),$("head").append("<style type='text/css' id='custom_css'>"+(this.customCss||"")+"</style>")},{create:function(t){return new e(t)}}}(),d=function(){var t=function(){function e(e){this.cm=e}function t(e){return e.state.search||(e.state.search=new n)}function o(e){return"string"==typeof e&&e==e.toLowerCase()}function r(e,t,r){return e.getSearchCursor(t,r,{caseFold:o(t),multiline:!0})}function n(){this.posFrom=this.posTo=this.lastQuery=this.query=null,this.overlay=null}return e.prototype.startSearch=function(e,r){var n=this.cm;this.clearSearch();var i=t(n);i.queryText=e,i.query=function(e){if(""==e)return e;var t=e.match(/^\/(.*)\/([a-z]*)$/);if(t)try{e=new RegExp(t[1],-1==t[2].indexOf("i")?"":"i")}catch(e){}else e=e.replace(/\\([nrt\\])/g,function(e,t){return"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\"==t?"\\":e});("string"==typeof e?""==e:e.test(""))&&(e=/x^/);return e}(e),n.removeOverlay(i.overlay,o(i.query)),this.findNext(!1,r)},e.prototype.clearSearch=function(){for(var e=this.cm,o=e.getAllMarks(),r=0;r<o.length;r++)o[r].clear();e.operation(function(){var o=t(e);o.lastQuery=o.query,o.query&&(o.query=o.queryText=null,e.removeOverlay(o.overlay),o.annotate&&(o.annotate.clear(),o.annotate=null))})},e.prototype.findNext=function(e,o){var n=this.cm,i=t(n);i.query&&n.operation(function(){var t=r(n,i.query,e?i.posFrom:i.posTo);if(t.find(e)||(t=r(n,i.query,e?CodeMirror.Pos(n.lastLine()):CodeMirror.Pos(n.firstLine(),0))).find(e)){n.setSelection(t.from(),t.to());for(var a=n.getAllMarks(),c=0;c<a.length;c++)a[c].clear();n.markText(t.from(),t.to(),{className:"styled-background"});var l=n.cursorCoords(t.from(),"local");n.scrollTo(0,l.top),i.posFrom=t.from(),i.posTo=t.to(),o&&o({from:t.from(),to:t.to()})}else o&&o(null)})},e.prototype.replace=function(e){var o=this.cm,n=t(o);if(n.query){var i=r(o,n.query,o.getCursor("from"));!function(){var t=i.from();if(i.findNext()||(i=r(o,n.query)).findNext()&&(!t||i.from().line!=t.line||i.from().ch!=t.ch)){o.setSelection(i.from(),i.to());var a=o.cursorCoords(i.from(),"local");o.scrollTo(0,a.top),i.replace("string"==typeof query?e:e.replace(/\$(\d)/g,function(e,t){}))}}()}},e.prototype.replaceAll=function(e){var o=this.cm,n=t(o);if(n.query){var i=n.query;o.operation(function(){for(var t=r(o,i);t.findNext();)if("string"!=typeof i){var n=o.getRange(t.from(),t.to()).match(i);t.replace(e.replace(/\$(\d)/g,function(e,t){return n[t]}))}else t.replace(e)})}},{create:function(t){return new e(t)}}}();function o(o){var r=$('<div id="editor_searchHelper" style="position:absolute;bottom:10px;width:100%;z-index:99;display:none;padding:20px;padding-bottom:5px"><div style="width:100%;text-align:right;margin-bottom:5px"><i class="fas fa-times icon"  style="cursor:pointer;margin-right:0px"></i></div> <form><div class="input-group mb-3"><input type="text" style="border:none" class="form-control" placeholder="查找内容" ><div class="input-group-append" data-search> <span class="input-group-text" ><i class="fas fa-search " style="cursor:pointer"></i></span> </div></div><div class="input-group mb-3" style="display:none"><input type="text" style="border:none" class="form-control" placeholder="替换内容" ><div class="input-group-append" data-replace style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-exchange-alt" ></i></span> </div><div class="input-group-append" data-replace-all style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-sync-alt" ></i></span> </div><div class="input-group-append" data-up style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-arrow-up" ></i></span> </div><div class="input-group-append" data-down style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-arrow-down" ></i></span> </div></div></form></div>');$("#editor_in").append(r);var n=t.create(o),i=function(){n.findNext(!1)},a=function(){n.findNext(!0)};this.keyMap={Up:a,Down:i};var c=function(){var e=r.find("input").eq(0).val();""!=$.trim(e)?n.startSearch(e,function(e){null==e?swal("没有找到符合条件的搜索内容"):(r.find(".input-group").eq(0).hide(),r.find(".input-group").eq(1).show(),o.focus())}):swal("搜索内容不能为空")},l=function(){var e=r.find("input").eq(1).val();n.replace(e)};r.find(".form-control").eq(0).on("keydown",function(t){"Enter"==e[t.keyCode]&&(c(),t.preventDefault())}),r.find(".form-control").eq(1).on("keydown",function(t){"Enter"==e[t.keyCode]&&(l(),t.preventDefault())}),r.on("click","[data-search]",c),r.on("click","[data-down]",i),r.on("click","[data-up]",a),r.on("click","[data-replace]",l),r.on("click","[data-replace-all]",function(){Swal.fire({title:"确定要替换全部吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(e=>{if(e.value){var t=r.find("input").eq(1).val();n.replaceAll(t)}})});var s=this;r.on("click",".fa-times",function(){s.close()}),this.ele=r,this.visible=!1,this.editor=o,this.searchUtil=n}return o.prototype.open=function(){this.editor.setOption("readOnly",!0),this.ele.show(),this.ele.find(".form-control").focus(),this.visible=!0,this.editor.addKeyMap(this.keyMap)},o.prototype.close=function(){this.searchUtil.clearSearch(),this.ele.hide(),this.ele.find("input").val(""),this.ele.find(".input-group").eq(0).show(),this.ele.find(".input-group").eq(1).hide(),this.editor.setOption("readOnly",!1),this.visible=!1,this.editor.removeKeyMap(this.keyMap)},o.prototype.isVisible=function(){return this.visible},{create:function(e){return new o(e)}}}();return function(){var e=CodeMirror.browser.mobile;CodeMirror.browser.ios;function o(){this.wrapperInstance={},this.commands={emoji:function(e){for(var t=e.editor,o=$.trim("😀 😁 😂 🤣 😃 😄 😅 😆 😉 😊 😋 😎 😍 😘 😗 😙 😚 ☺️ 🙂 🤗 🤔 😐 😑 😶 🙄 😏 😣 😥 😮 🤐 😯 😪 😫 😴 😌 😛 😜 😝 🤤 😒 😓 😔 😕 🙃 🤑 😲 ☹️ 🙁 😖 😞 😟 😤 😢 😭 😦 😧 😨 😩 😬 😰 😱 😳 😵 😡 😠 😷 🤒 🤕 🤢 🤧 😇 🤠 🤡 🤥 🤓 😈 👿 👹 👺 💀 👻 👽 🤖 💩 😺 😸 😹 😻 😼 😽 🙀 😿 😾").split(" "),r="",n=0;n<o.length;n++)r+='<span data-emoji style="cursor:pointer">'+o[n]+"</span>";swal({html:r}),$(Swal.getContent()).find("[data-emoji]").click(function(){var e=$(this).text();""==t.getSelection()?t.replaceRange(e,t.getCursor()):t.replaceSelection(e),Swal.close()})},heading:function(e){var t=e.editor;!async function(){const{value:e}=await Swal.fire({input:"select",inputValue:"1",inputOptions:{1:"H1",2:"H2",3:"H3",4:"H4",5:"H5",6:"H6"},inputPlaceholder:"",showCancelButton:!0});if(e){for(var o=parseInt(e),r=t.getSelection(),n="\n",i=0;i<o;i++)n+="#";if(n+=" ",""==r){t.replaceRange(n,t.getCursor()),t.focus();var a=t.getCursor(),c=a.line,l=a.ch;t.setCursor({line:c,ch:l+o})}else t.replaceSelection(n+r)}}()},bold:function(e){var t=e.editor,o=t.getSelection();if(""==o){t.replaceRange("****",t.getCursor()),t.focus();var r="**".length,n=t.getCursor(),i=n.line,a=n.ch;t.setCursor({line:i,ch:a-r})}else t.replaceSelection("**"+o+"**")},italic:function(e){var t=e.editor,o=t.getSelection();if(""==o){t.replaceRange("**",t.getCursor()),t.focus();var r="*".length,n=t.getCursor(),i=n.line,a=n.ch;t.setCursor({line:i,ch:a-r})}else t.replaceSelection("*"+o+"*")},quote:function(e){var t=e.editor,o=t.getSelection();if(""==o){t.replaceRange("\n> ",t.getCursor()),t.focus();var r=t.getCursor(),n=r.line,i=r.ch;t.setCursor({line:n,ch:i})}else t.replaceSelection("> "+o)},strikethrough:function(e){var t=e.editor,o=t.getSelection();if(""==o){t.replaceRange("~~~~",t.getCursor()),t.focus();var r="~~".length,n=t.getCursor(),i=n.line,a=n.ch;t.setCursor({line:i,ch:a-r})}else t.replaceSelection("~~"+o+"~~")},link:function(e){var t=e.editor,o=t.getSelection();if(""==o){t.replaceRange("[](https://)",t.getCursor()),t.focus();var r=t.getCursor(),n=r.line,i=r.ch;t.setCursor({line:n,ch:i-11})}else t.replaceSelection("["+o+"](https://)")},codeBlock:function(e){var t=e.editor,o="\n```";o+="\n",o+=t.getSelection()+"",o+="\n",o+="```",t.focus(),t.replaceSelection(o),t.setCursor({line:t.getCursor("start").line-1,ch:0})},code:function(e){var t=e.editor,o=t.getSelection();if(""==o){t.replaceRange("``",t.getCursor()),t.focus();var r=t.getCursor(),n=r.line,i=r.ch;t.setCursor({line:n,ch:i-1})}else t.replaceSelection("`"+o+"`")},uncheck:function(e){var t=e.editor,o=t.getSelection();if(""==o){t.replaceRange("\n- [ ] ",t.getCursor()),t.focus();var r=t.getCursor(),n=r.line,i=r.ch;t.setCursor({line:n,ch:i})}else t.replaceSelection("- [ ] "+o)},check:function(e){var t=e.editor,o=t.getSelection();if(""==o){t.replaceRange("\n- [x] ",t.getCursor()),t.focus();var r=t.getCursor(),n=r.line,i=r.ch;t.setCursor({line:n,ch:i})}else t.replaceSelection("- [x] "+o)},table:function(e){var t=e.editor;swal({html:'<input class="swal2-input" placeholder="行"><input class="swal2-input" placeholder="列">',preConfirm:function(){return new Promise(function(e){var t=$(Swal.getContent()).find("input");e([t.eq(0).val(),t.eq(1).val()])})}}).then(function(e){var o=e.value,r=parseInt(o[0])||3,n=parseInt(o[1])||3;n<1&&(n=3),r<1&&(r=3);for(var i="",a=0;a<=r;a++)i+="|    ";i+="\n";for(a=0;a<r;a++)i+="|  -  ";if(i+="|",n>1){i+="\n";for(a=0;a<n-1;a++){for(var c=0;c<=r;c++)i+="|    ";i+="\n"}}t.replaceSelection("\n"+i),innerBar.show()}).catch(swal.noop)},search:function(e){e.searchHelper.isVisible()?e.searchHelper.close():e.searchHelper.open()}}}o.prototype.create=function(e){this.wrapperInstance.wrapper&&this.wrapperInstance.wrapper.remove();var t=new u(e);return this.wrapperInstance.wrapper=t,t},o.prototype.getEditor=function(e){return e.doc?e:e.editor},o.prototype.getWrapper=function(e){return e.doc?e.state.wrapper:e};var o=new o;function u(o){var u=$('<div id="editor_wrapper"><div id="editor_toc"></div><div id="editor_in"><div id="editor_toolbar"></div><textarea  style="width: 100%; height: 100%"></textarea><div id="editor_stat"></div><div id="editor_innerBar"></div></div><div class="markdown-body" id="editor_out"></div></div>');$("body").append(u),this.scrollTop=$(window).scrollTop(),$("body").addClass("editor_noscroll"),$("html").addClass("editor_noscroll"),this.wrapperElement=u[0],e||($("#editor_in").show(),$("#editor_out").css({visibility:"visible"})),$("#editor_wrapper").animate({scrollLeft:$("#editor_toc").outerWidth()},0),this.eventHandlers=[],this.themeHandler=s.create(o);var f=this.themeHandler.getTheme();f.render(),this.theme=f;var p=e?"native":"overlay",m=CodeMirror.fromTextArea(document.getElementById("editor_wrapper").querySelector("textarea"),{mode:{name:"gfm"},lineNumbers:!1,matchBrackets:!0,lineWrapping:!0,dragDrop:!0,scrollbarStyle:p,theme:f.editor.theme||"default",styleSelectedText:!0,extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"}}),v=o.turndownService;if(v||(v=new window.TurndownService({headingStyle:"atx",codeBlockStyle:"fenced",defaultReplacement:function(e,t){return t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML}})).use(window.turndownPluginGfm.gfm),!1!==o.drop_htmlMarkdownEnable){var g=o.drop_htmlMarkdownHandler||function(e,t,o){return"md"==e?t:"html"==e||"htm"==e?o.turndown(t):void 0};m.setOption("dropContentHandler",function(e,t){var o=e.split(".").pop().toLowerCase();return"md"==o||"html"==o||"htm"==o?g(o,t,v):""})}this.theme=f,this.sync=c.create(m,$("#editor_out")[0],o),this.render=i.create(o,f),this.searchHelper=d.create(m),this.toolbar=a.create($("#editor_toolbar")[0]);var y=a.create($("#editor_innerBar")[0]);y.hide(),this.innerBar=y;var w,b=this;if(!e){var k,C,x=n(o.render_ms,500);b.onRemove(function(){k&&clearTimeout(k),C&&clearTimeout(C)}),m.on("change",function(){if(k&&clearTimeout(k),k=setTimeout(function(){b.doRender(!0)},x),!1!==o.stat_enable){var e=o.stat_formatter||function(e){return"当前字数："+e.getValue().length};$("#editor_stat").html(e(b)).show(),C&&clearTimeout(C),C=setTimeout(function(){$("#editor_stat").hide()},1e3)}});var _=function(){b.doSync()},S=!1!==o.sync_enable;S&&m.on("scroll",_),this.syncEnable=S,this.scrollHandler=_}if(e){function T(e){return!(!r(e)&&null!=e)||!(function(e){var t=window.getComputedStyle(e)["overflow-x"];return("scroll"===t||"auto"===t)&&e.scrollWidth>e.clientWidth}(e)&&$(e).scrollLeft()>0)&&T(e.parentElement)}$("#editor_toc").touchwipe({wipeLeft:function(){b.toEditor()},min_move_x:10,max_move_y:5}),$(m.getScrollerElement()).touchwipe({wipeLeft:function(){b.toPreview()},wipeRight:function(e){b.toToc()},min_move_x:10,max_move_y:5}),$("#editor_out").touchwipe({wipeRight:function(e){T(e.target)&&b.toEditor()},min_move_x:10,max_move_y:5})}if(b.onRemove(function(){w&&clearTimeout(w)}),$("#editor_toc").on("click","[data-line]",function(){var t=parseInt($(this).data("line"));m.scrollIntoView({line:t}),w=setTimeout(function(){var o=m.charCoords({line:t,ch:0},"local").top;m.scrollTo(null,o),(e||b.fullscreen)&&b.toEditor()},500)}),this.editor=m,this.config=o,!1!==this.config.backupEnable&&(this.backup=l.create(this)),function(e){var o=t?{"Ctrl-B":"bold","Ctrl-I":"italic","Shift-Cmd-T":"table","Ctrl-H":"heading","Ctrl-L":"link","Ctrl-Q":"quote","Shift-Cmd-B":"codeBlock","Shift-Cmd-U":"uncheck","Shift-Cmd-I":"check","Ctrl-S":"search","Cmd-Enter":function(){e.requestFullScreen()}}:{"Ctrl-B":"bold","Ctrl-I":"italic","Alt-T":"table","Ctrl-H":"heading","Ctrl-L":"link","Ctrl-Q":"quote","Alt-B":"codeBlock","Alt-U":"uncheck","Alt-I":"check","Alt-S":"search","Ctrl-Enter":function(){e.requestFullScreen()}};e.bindKey(o)}(this),function(e){for(var t=e.innerBar,o=e.editor,r=e.config,n=$("#editor_innerBar"),i=(CodeMirror.browser.ios,r.innerBar_icons||["emoji","heading","bold","italic","quote","strikethrough","link","code","code-block","uncheck","check","table","undo","redo","close"]),a=0;a<i.length;a++){var c=i[a];"emoji"==c&&t.addIcon("far fa-grin-alt icon",function(){e.execCommand("emoji")}),"heading"==c&&t.addIcon("fas fa-heading icon",function(){e.execCommand("heading")}),"bold"==c&&t.addIcon("fas fa-bold icon",function(){e.execCommand("bold")}),"italic"==c&&t.addIcon("fas fa-italic icon",function(){e.execCommand("italic")}),"quote"==c&&t.addIcon("fas fa-quote-left icon",function(){e.execCommand("quote")}),"strikethrough"==c&&t.addIcon("fas fa-strikethrough icon",function(){e.execCommand("strikethrough")}),"link"==c&&t.addIcon("fas fa-link icon",function(){e.execCommand("link")}),"code"==c&&t.addIcon("fas fa-code icon",function(){e.execCommand("code")}),"code-block"==c&&t.addIcon("fas fa-file-code icon",function(){e.execCommand("codeBlock")}),"uncheck"==c&&t.addIcon("far fa-square icon",function(){e.execCommand("uncheck")}),"check"==c&&t.addIcon("far fa-check-square icon",function(){e.execCommand("check")}),"table"==c&&t.addIcon("fas fa-table icon",function(){e.execCommand("table")}),"undo"==c&&t.addIcon("fas fa-undo icon",function(){e.editor.execCommand("undo")}),"redo"==c&&t.addIcon("fas fa-redo icon",function(){e.editor.execCommand("redo")}),"close"==c&&t.addIcon("fas fa-times icon",function(){t.hide()})}CodeMirror.browser.mobile?(o.on("cursorActivity",function(){!function(e){var t=o.defaultTextHeight(),r=(c=o.cursorCoords(!0,"local").top)-e.height()-2*t;if(r<0)n.css({top:o.cursorCoords(!0).top+2*t+"px"}),e.show();else{var i=o.getScrollerElement(),a=$(i);if(a[0].scrollHeight-a.scrollTop()-a.outerHeight()<0){var c=o.cursorCoords(!0).top-2*t-e.height()-$("#editor_toolbar").height();c>0?(n.css({top:o.cursorCoords(!0).top-2*t-e.height()+"px"}),e.show()):(n.css({top:o.cursorCoords(!0).top+2*t+"px"}),e.show())}else{o.cursorCoords(!0).top;o.scrollTo(0,r),setTimeout(function(){var r=o.cursorCoords(!0).top,i=r>e.height()+2*t;n.css({top:i?r-2*t-e.height()+"px":r+2*t+"px"}),e.show()},50)}}}(t)}),o.getScrollerElement().addEventListener("touchmove",function(e){t.hide()})):(o.on("cursorActivity",function(){var e,r;e=t,r=o.defaultTextHeight(),n.css({top:o.cursorCoords(!0).top+2*r+"px"}),e.show()}),o.getScrollerElement().addEventListener("touchmove",function(e){t.hide()}),o.on("scroll",function(){t.hide()}))}(this),function(e){for(var t,o=e.editor,r=e.theme,n=e.config,i=function(){var i,a=function(t){$(t.target).hasClass("fa-cog")||p(r.toolbar.color,function(t){r.toolbar.color=t,r.render(),e.saveTheme()})},c=function(){p(r.stat.color,function(t){r.stat.color=t,r.render(),e.saveTheme()})},l=function(){p(r.searchHelper.color,function(t){r.searchHelper.color=t,r.render(),e.saveTheme()})},s=function(){p(r.bar.color,function(t){r.bar.color=t,r.render(),e.saveTheme()})},d=!1,u=function(){d||async function(){d=!0;const{value:t}=await Swal.fire({input:"select",inputValue:r.editor.theme||"",inputOptions:{"3024-day":"3024-day","3024-night":"3024-night",abcdef:"abcdef","ambiance-mobile":"ambiance-mobile",ambiance:"ambiance","base16-dark":"base16-dark","base16-light":"base16-light",bespin:"bespin",blackboard:"blackboard",cobalt:"cobalt",colorforth:"colorforth",darcula:"darcula",dracula:"dracula","duotone-dark":"duotone-dark","duotone-light":"duotone-light",eclipse:"eclipse",elegant:"elegant","erlang-dark":"erlang-dark","gruvbox-dark":"gruvbox-dark",hopscotch:"hopscotch",icecoder:"icecoder",idea:"idea",isotope:"isotope","lesser-dark":"lesser-dark",liquibyte:"liquibyte",lucario:"lucario",material:"material",mbo:"mbo","mdn-like":"mdn-like",midnight:"midnight",monokai:"monokai",neat:"neat",neo:"neo",night:"night","oceanic-next":"oceanic-next","panda-syntax":"panda-syntax","paraiso-dark":"paraiso-dark","paraiso-light":"paraiso-light","pastel-on-dark":"pastel-on-dark",railscasts:"railscasts",rubyblue:"rubyblue",seti:"seti",shadowfox:"shadowfox",solarized:"solarized",ssms:"ssms","the-matrix":"the-matrix","tomorrow-night-bright":"tomorrow-night-bright","tomorrow-night-eighties":"tomorrow-night-eighties",ttcn:"ttcn",twilight:"twilight","vibrant-ink":"vibrant-ink","xq-dark":"xq-dark","xq-light":"xq-light",yeti:"yeti",zenburn:"zenburn"},inputPlaceholder:"选择主题",showCancelButton:!0});t&&(r.editor.theme=t,r.render({editorThemeLoad:function(t){setTimeout(function(){o.setOption("theme",t);var n=window.getComputedStyle(o.getWrapperElement(),null).getPropertyValue("background-color");r.inCss.background=n,r.render(),e.saveTheme()},100)}}));setTimeout(function(){d=!1},1e3)}()},h=function(){!async function(){const{value:t}=await Swal.fire({input:"select",inputValue:r.mermaid.theme||"",inputOptions:{default:"default",forest:"forest",dark:"dark",neutral:"neutral"},inputPlaceholder:"选择主题",showCancelButton:!0});t&&(r.mermaid.theme=t,e.saveTheme(),e.doRender(!1),e.doSync())}()},f=!1;var p=function(e,t){!async function(){const{value:e}=await Swal.fire({html:'<div class="_colorpicker"></div>',showCancelButton:!0})}();var o=$(Swal.getContent()).find("._colorpicker");o.colorpicker({inline:!0,container:!0,template:'<div class="colorpicker"><div class="colorpicker-saturation"><i class="colorpicker-guide"></i></div><div class="colorpicker-hue"><i class="colorpicker-guide"></i></div><div class="colorpicker-alpha">   <div class="colorpicker-alpha-color"></div>   <i class="colorpicker-guide"></i></div></div>'}),e&&o.colorpicker("setValue",e),o.on("colorpickerChange",function(e){e.color&&t&&t(e.color.toString())})};return{toggle:function(){return f?(f=!1,i.off("click",s),i.remove(),$("#editor_searchHelper").off("click",l),$("#editor_searchHelper input").removeAttr("value"),e.searchHelper.close(),o.off("cursorActivity",u),$("#editor_toolbar").off("click",a),$("#editor_stat").off("click",c),$("#editor_out").off("click",".mermaid",h),$("#editor_stat").text("").hide(),$(".noclick").removeClass("noclick"),o.setOption("readOnly",!1)):(f=!0,r.clone(),$("<link>").appendTo("head").attr({id:"colorpicker-css",type:"text/css",rel:"stylesheet",href:n.res_colorpickerCss||"colorpicker/dist/css/bootstrap-colorpicker.min.css"}),$("<script>").appendTo("body").attr({id:"colorpicker-js",src:n.res_colorpickerJs||"colorpicker/dist/js/bootstrap-colorpicker.min.js"}),o.setOption("readOnly",!0),$("#editor_searchHelper input").attr("value","点击设置字体颜色"),$("#editor_searchHelper").children().addClass("noclick"),e.searchHelper.open(),$("#editor_searchHelper").on("click",l),$("#editor_toolbar").children().addClass("noclick"),$(t).removeClass("noclick"),$("#editor_toolbar").on("click",a),$("#editor_stat").text("点击设置字体颜色").show(),$("#editor_stat").on("click",c),o.on("cursorActivity",u),$("#editor_out").on("click",".mermaid",h),(i=$("#editor_innerBar").clone()).css({visibility:"visible",top:"100px"}),i.children().addClass("noclick"),$("#editor_in").append(i),i.on("click",s)),f},isThemeMode:function(){return f}}}(),a=n.toolbar_icons||["toc","innerBar","backup","search","config","expand"],c=0;c<a.length;c++){var l=a[c];if("toc"==l&&e.toolbar.addIcon("fas fa-book icon mobile-hide nofullscreen",function(){d()}),"innerBar"==l&&(e.innerBar.keepHidden=!0,e.innerBar.hide(),e.toolbar.addIcon("far icon fa-square",function(e){h(e)})),"search"==l&&e.toolbar.addIcon("fas fa-search icon",function(){e.execCommand("search")}),"backup"==l&&!1!==e.config.backupEnable){e.toolbar.addIcon("fas icon fa-upload ",function(t){e.backup.backup()}),e.toolbar.addIcon("fas icon fa-download ",function(t){f(e.backup)});e.toolbar.addIcon("far fa-file icon",function(t){o=e.backup,Swal.fire({title:"要打开一篇新文档吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(e=>{e.value&&o.newDocument()});var o})}"config"==l&&e.toolbar.addIcon("fas icon fa-cog nofullscreen",function(){swal({html:'<input type="checkbox"  />主题编辑模式 <p style="margin-top:0.5rem"><button style="margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;">自定义css</button></p>'});var e=$(Swal.getContent().querySelector("input"));e.prop("checked",i.isThemeMode),e.change(function(){i.toggle()}),$(Swal.getContent().querySelector("button")).click(function(){p()})},function(e){t=e}),"expand"==l&&e.toolbar.addIcon("fas fa-expand icon mobile-hide",function(t){$(t).hasClass("fa-expand")?e.requestFullScreen():e.exitFullScreen()},function(t){if(screenfull.enabled){var o=function(){screenfull.isFullscreen?$(t).removeClass("fa-expand").addClass("fa-compress"):$(t).removeClass("fa-compress").addClass("fa-expand")};e.onRemove(function(){screenfull.off("change",o)}),screenfull.on("change",o)}})}var s=!1;function d(){s?e.toEditor(function(){s=!1}):e.toToc(function(){s=!0})}var u=e.innerBar;function h(e){u.keepHidden=!u.keepHidden,u.keepHidden?(u.hide(),$(e).addClass("fa-square").removeClass("fa-check-square")):$(e).addClass("fa-check-square").removeClass("fa-square")}function f(e){for(var t=e.getDocuments(),o=t.length-1;o>=0;o--)if("default"==t[o].title){t.splice(o,1);break}if(0==t.length)swal("没有保存的文档");else{for(var r='<table style="width:100%">',o=0;o<t.length;o++){var n=t[o];r+="<tr><td>"+n.title+'</td><td><i class="fas fa-times" data-title="'+n.title+'" style="margin-right:20px;cursor:pointer"></i><i data-title="'+n.title+'" class="fas fa-arrow-down" style=";cursor:pointer"></i></td><tr>'}r+="</table>",swal({html:r}),$(Swal.getContent()).find(".fa-times").click(function(){var t=$(this).data("title");Swal.fire({title:"确定要删除吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(o=>{o.value&&(e.deleteDocument(t),f(e))})}),$(Swal.getContent()).find(".fa-arrow-down").click(function(){var t=$(this).data("title");Swal.fire({title:"确定要加载吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(o=>{o.value&&e.loadDocument(t)})})}}function p(){!async function(){const{value:t}=await Swal.fire({input:"textarea",inputPlaceholder:"css",inputValue:r.customCss||"",showCancelButton:!0});t&&(r.customCss=t,r.render(),e.saveTheme())}()}}(this),this.fullscreen=!1,screenfull.enabled){var H=function(){b.fullscreen=screenfull.isFullscreen,function(e,o){if(!CodeMirror.browser.mobile){var r=e.editor,n=r.getWrapperElement(),i=function(t){var o=t.which||t.keyCode;(t.ctrlKey||t.metaKey)&&37==o&&($("#editor_out").removeAttr("tabindex"),e.toEditor(function(){r.focus();var e=r.state.fullScreenRestore;window.scrollTo(e.scrollLeft,e.scrollTop)}))},a=function(t){var o=t.which||t.keyCode;(t.ctrlKey||t.metaKey)&&39==o&&($("#editor_toc").removeAttr("tabindex"),e.toEditor(function(){r.focus();var e=r.state.fullScreenRestore;window.scrollTo(e.scrollLeft,e.scrollTop)}))},c=function(){e.toPreview(function(){$("#editor_out").prop("tabindex",0),$("#editor_out").focus()})},l=function(){e.toToc(function(){$("#editor_toc").prop("tabindex",0),$("#editor_toc").focus()})},s=t?{"Cmd-Right":c,"Cmd-Left":l}:{"Ctrl-Right":c,"Ctrl-Left":l};if(o)e.editor.addKeyMap(s),$("#editor_out").on("keydown",i),$("#editor_toc").on("keydown",a),$(e.getFullScreenElement()).addClass("editor_fullscreen"),r.state.fullScreenRestore={scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,width:n.style.width,height:n.style.height},n.style.width="",n.style.height="auto",n.className+=" CodeMirror-fullscreen",document.documentElement.style.overflow="hidden",r.refresh();else{e.editor.removeKeyMap(s),$("#editor_out").off("keydown",i),$("#editor_toc").off("keydown",a),$(e.getFullScreenElement()).removeClass("editor_fullscreen"),n.className=n.className.replace(/\s*CodeMirror-fullscreen\b/,""),document.documentElement.style.overflow="";var d=r.state.fullScreenRestore;n.style.width=d.width,n.style.height=d.height,window.scrollTo(d.scrollLeft,d.scrollTop),r.refresh()}e.toEditor(function(){e.doRender(!1)},0)}}(b,screenfull.isFullscreen)};b.onRemove(function(){screenfull.off("change",H)}),screenfull.on("change",H)}h(this,"load")}function h(e,t,o){for(var r=0;r<e.eventHandlers.length;r++){var n=e.eventHandlers[r];if(n.name==t)try{n.handler.call(e,o)}catch(e){}}}return u.prototype.execCommand=function(e){var t=o.commands[e];r(t)||t.call(null,this)},u.prototype.doRender=function(e){this.render.renderAt(this.editor.getValue(),$("#editor_out")[0],e),function(){for(var e=$("#editor_out").children("h1,h2,h3,h4,h5,h6"),t=[],o=0;o<e.length;o++){var r=e[o],n=r.tagName.substring(1),i=r.getAttribute("data-line");if(0==t.length)t.push([{indent:n,name:r.textContent,line:i}]);else{var a=t[t.length-1],c=a[0];n>c.indent?a.push({indent:n,name:r.textContent,line:i}):t.push([{indent:n,name:r.textContent,line:i}])}}var l="<h1>TOC</h1><hr>";if(t.length>0)for(var o=0;o<t.length;o++)for(var s=t[o],d=0;d<s.length;d++){var u=s[d],h=u.indent;l+="<h"+h+' data-line="'+u.line+'">'+u.name+"</h"+h+">"}try{var f=document.createElement("div");f.setAttribute("id","editor_toc"),f.innerHTML=l,morphdom($("#editor_toc")[0],f)}catch(e){$("#editor_toc").html(l)}}()},u.prototype.remove=function(){var e=this,t=function(){Swal.close(),h(e,"remove"),$(e.getFullScreenElement()).removeClass("editor_fullscreen"),$("body").removeClass("editor_noscroll"),$("html").removeClass("editor_noscroll"),$("html,body").scrollTop(e.scrollTop),e.wrapperElement.parentNode.removeChild(e.wrapperElement),wrapperInstance.wrapper=void 0,delete wrapperInstance.wrapper};this.fullscreen?this.exitFullScreen().then(function(){t()}):t()},u.prototype.doSync=function(){this.sync.doSync()},u.prototype.requestFullScreen=function(){e||(screenfull.enabled?screenfull.request(this.getFullScreenElement()):swal("当前浏览器不支持全屏模式"))},u.prototype.getFullScreenElement=function(){return document.body},u.prototype.exitFullScreen=function(){if(!e&&screenfull.enabled)return screenfull.exit()},u.prototype.enableSync=function(){this.syncEnable||(editor.on("scroll",this.scrollHandler),this.syncEnable=!0)},u.prototype.getHtml=function(){return this.render.getHtml(this.editor.getValue())},u.prototype.getValue=function(){return this.editor.getValue()},u.prototype.setValue=function(e){return this.editor.setValue(e)},u.prototype.disableSync=function(){this.syncEnable&&(editor.off("scroll",this.scrollHandler),this.syncEnable=!1)},u.prototype.on=function(e,t){this.eventHandlers.push({name:e,handler:t})},u.prototype.off=function(e,t){for(var o=0;o<this.eventHandlers.length;o++){if((t=this.eventHandlers[o]).name==e&&t.handler==t){this.eventHandlers.splice(o,1);break}}},u.prototype.onRemove=function(e){this.on("remove",e)},u.prototype.offRemove=function(e){this.off("remove",e)},u.prototype.toEditor=function(e,t){var o=n(t,n(this.config.swipe_animateMs,500));$("#editor_wrapper").animate({scrollLeft:$("#editor_in").width()},o,function(){e&&e()})},u.prototype.toToc=function(t,o){this.editor.unfocus(),e&&this.doRender(!0);var r=n(o,n(this.config.swipe_animateMs,500));$("#editor_wrapper").animate({scrollLeft:0},r,function(){t&&t()})},u.prototype.toPreview=function(t,o){if(e||this.fullscreen){this.editor.unfocus(),e&&(this.doRender(!0),this.doSync());var r=n(o,n(this.config.swipe_animateMs,500));$("#editor_wrapper").animate({scrollLeft:$("#editor_out")[0].offsetLeft},r,function(){t&&t()})}},u.prototype.saveTheme=function(){this.themeHandler.saveTheme(this.theme)},u.prototype.bindKey=function(e){var t={},n=this;Object.keys(e).forEach(function(i,a){var c=e[i];if("string"==typeof c){var l=o.commands[c];if(!r(l)){t[i]=function(){l.call(null,n)}}}else t[i]=c}),this.editor.addKeyMap(t)},u.prototype.unbindKey=function(e){for(var t=this.editor.state.keyMaps,o=0;o<e.length;o++)for(var r=0;r<t.length;r++)delete t[r][e[o]]},o}()}();
