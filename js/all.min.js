var EditorWrapper=function(){"use strict";function e(e,t){let r,o=Array.prototype.slice.call(t.attributes);for(;r=o.pop();)e.setAttribute(r.nodeName,r.nodeValue)}CodeMirror.prototype.renderAllDoc=function(e){this.setOption("readOnly",!0);for(var t=this.getViewport(),r=this.lineCount()-1;t.to<r&&t.to>0;)this.scrollIntoView({line:t.to}),t=this.getViewport();this.scrollIntoView({line:r}),this.scrollIntoView({top:e}),this.setOption("readOnly",!1)},CodeMirror.keyMap.default["Shift-Tab"]="indentLess",CodeMirror.keyMap.default.Tab="indentMore";var t=function(e){return void 0===e};function r(e,r){return t(e)?r:e}var o=function(){function t(e,t){var r=["footnote","katex","mermaid","anchor","task-lists","sup","sub","abbr"];this.md=createMarkdownParser({html:!1!==e.render_allowHtml,plugins:e.render_plugins||r,lineNumber:!0}),this.md2=createMarkdownParser({html:!1!==e.render_allowHtml,plugins:e.render_plugins||r,lineNumber:!1}),this.config=e,this.theme=t}var r=!1;var o=!1;return t.prototype.getHtml=function(e){return this.md2.render(e)},t.prototype.renderAt=function(t,n,i){var a=$.parseHTML2(this.md.render(t));null!=a.querySelector(".mermaid")&&function(e,t){if(!r){r=!0,$("<script>").appendTo("body").attr({src:t.res_mermaid_js||"js/mermaid.min.js"});var o=setInterval(function(){try{mermaid.initialize({theme:e.mermaid.theme||"default"}),clearInterval(o),mermaid.init({},"#editor_out .mermaid")}catch(e){}},20)}}(this.theme,this.config),null!=a.querySelector(".katex")&&function(e){if(!o){o=!0,$("<link>").appendTo("head").attr({type:"text/css",rel:"stylesheet",href:e.res_katex_css||"katex/katex.min.css"}),$("<script>").appendTo("body").attr({src:e.res_katex_js||"katex/katex.min.js"});var t=setInterval(function(){try{katex.renderToString("",{throwOnError:!1}),clearInterval(t);for(var e=document.getElementById("editor_out").querySelectorAll(".katex"),r=0;r<e.length;r++){var o=e[r];o.innerHTML=katex.renderToString(o.textContent,{throwOnError:!1,displayMode:!0})}}catch(e){}},20)}}(this.config),this.config.render_beforeRender&&this.config.render_beforeRender(a);var l=a.body.innerHTML;if(i){var c=document.createElement("div");e(c,n),c.innerHTML=l,morphdom(n,c,{onBeforeElUpdated:function(t,r){if(t.isEqualNode(r))return!1;if(t.classList.contains("mermaid-block")&&r.classList.contains("mermaid-block")&&t.getElementsByClassName("mermaid-source")[0].textContent==r.getElementsByClassName("mermaid-source")[0].textContent)return e(t,r),!1;return!0}})}else n.innerHTML=l;try{mermaid.initialize({theme:this.theme.mermaid.theme||"default"}),mermaid.init({},"#editor_out .mermaid")}catch(e){}},{create:function(e,r){return new t(e,r)}}}(),n=function(){function e(e,t){this.element=$(e),this.keepHidden=!1}return e.prototype.hide=function(){this.element.css({visibility:"hidden"}),this.hidden=!0},e.prototype.height=function(){return this.element.height()},e.prototype.show=function(){this.keepHidden||(this.element.css({visibility:"visible"}),this.hidden=!1)},e.prototype.addItem=function(e){insertItem(this,e,this.items.length)},e.prototype.getSize=function(){return this.element.find("i").length},e.prototype.insertIcon=function(e,t,r,o){var n=function(e,t){var r=document.createElement("i");return r.setAttribute("class",e),r.setAttribute("style","cursor: pointer;margin-right:20px"),r.addEventListener("click",function(){t(r)}),r}(e,t);o&&o(n);var i=this.element[0];r>=this.getSize()?i.appendChild(n):r<=0?i.insertBefore(n,i.childNodes[0]):i.insertBefore(n,i.childNodes[r])},e.prototype.addIcon=function(e,t,r){this.insertIcon(e,t,this.getSize(),r)},e.prototype.removeIcon=function(e){for(var t=this.element[0].querySelectorAll("i"),r=t.length-1;r>=0;r--){var o=t[r];e(o)&&this.element[0].removeChild(o)}},{create:function(t){return new e(t)}}}(),i=function(e){function r(e,t,r){this.editor=e,this.scrollElement=t,this.config=r}var o=function(e,t){return e.querySelector('[data-line="'+t+'"]')},n=function(e){return e.querySelectorAll("[data-line]")};return r.prototype.doSync=function(){var e=function(e,r){var o=[],i=n(r);i.forEach(function(e){o.push(parseInt(e.getAttribute("data-line")))});var a=e.getScrollInfo().top;let l,c;for(let t=0;t<o.length;t++){const r=o[t];if(!(e.heightAtLine(r,"local")<a)){c=r;break}l=r}!t(l)&&t(c)&&(c=parseInt(i[i.length-1].getAttribute("data-end-line")));let s=0;return t(l)||t(c)||l===c||(s=(a-e.heightAtLine(l,"local"))/(e.heightAtLine(c,"local")-e.heightAtLine(l,"local"))),{lastMarker:l,nextMarker:c,percentage:s}}(this.editor,this.scrollElement);let r=0;var i=$(this.scrollElement);let a=i.outerHeight();var l,c,s,u;t(e.lastMarker)||(l=o(this.scrollElement,e.lastMarker),t(l)||(r=l.offsetTop-10)),t(e.nextMarker)||(c=o(this.scrollElement,e.nextMarker)||(s=this.scrollElement,u=e.nextMarker,s.querySelector('[data-end-line="'+u+'"]')),t(c)||(a=c.offsetTop-10));var d=a-r;t(l)||t(c)||l!==c||(d=l.clientHeight);var f=this.config.sync_animateMs||0;const h=r+d*e.percentage;i.stop(!0),i.animate({scrollTop:h},f)},{create:function(e,t,o){return new r(e,t,o)}}}();return function(){var e=CodeMirror.browser.mobile,a=(CodeMirror.browser.ios,function(){function e(e){this.toolbar={},this.bar={},this.stat={},this.editor={},this.inCss={},this.searchHelper={},this.mermaid={},this.hljs={theme:"github"},this.customCss=void 0,this.timer=void 0,this.config=e}var t="markdown-editor-theme";function r(e,r){var o=JSON.stringify(e);try{localStorage.setItem(t,o),r&&r("success")}catch(e){r&&r("fail")}}e.prototype.store=function(e){this.timer&&clearTimeout(this.timer);var t=this;this.timer=setTimeout(function(){r(t,function(t){e&&e("success"==t)})},500)},e.prototype.reset=function(){var t=new e;return r(t),t.render(),t},e.prototype.clone=function(){var t=JSON.parse(JSON.stringify(this)),r=new e;return r.toolbar=t.toolbar,r.bar=t.bar,r.stat=t.stat,r.editor=t.editor,r.inCss=t.inCss,r.cursorHelper=t.cursorHelper,r.searchHelper=t.searchHelper,r.mermaid=t.mermaid,r.customCss=t.customCss,r};var o=function(r){var o;if(function(e){if(e){var r=localStorage.getItem(t);e(null==r?null:$.parseJSON(r))}}(function(e){o=e}),!o||null==o)return new e(r);var n=new e(r);return n.toolbar=o.toolbar,n.bar=o.bar,n.stat=o.stat,n.editor=o.editor,n.inCss=o.inCss,n.cursorHelper=o.cursorHelper,n.searchHelper=o.searchHelper,n.mermaid=o.mermaid,n.customCss=o.customCss,n};return e.prototype.render=function(){l(this),function(e){if(e.hljs.theme){var t=e.hljs.theme,r=e.config.res_hljsTheme||function(e){return"highlight/styles/"+e+".css"};0==$("hljs-theme-"+t).length&&$('<link id="hljs-theme-'+t+'" >').appendTo("head").attr({type:"text/css",rel:"stylesheet",href:r(t)})}}(this);var e="";e+="#editor_toolbar{color:"+(this.toolbar.color||"inherit")+"}\n",e+="#editor_innerBar{color:"+(this.bar.color||"inherit")+"}\n",e+="#editor_stat{color:"+(this.stat.color||"inherit")+"}\n",e+="#editor_in{background:"+(this.inCss.background||"inherit")+"}\n";var t=this.searchHelper.color||"inherit";e+="#editor_searchHelper{color:"+t+"}\n#editor_searchHelper .form-control{color:"+t+"}\n#editor_searchHelper .input-group-text{color:"+t+"}\n#editor_searchHelper .form-control::placeholder {color: "+t+";opacity: 1;}\n#editor_searchHelper .form-control::-ms-input-placeholder {color: "+t+";}\n#editor_searchHelper .form-control::-ms-input-placeholder {color: "+t+";}",$("#custom_theme").remove(),""!=$.trim(e)&&$("head").append("<style type='text/css' id='custom_theme'>"+e+"</style>"),$("#custom_css").remove(),$("head").append("<style type='text/css' id='custom_css'>"+(this.customCss||"")+"</style>")},{current:function(e){return o(e)}}}());function l(e,t){if(e.editor.theme){var r=e.editor.theme,o=e.config.res_editorTheme||function(e){return"codemirror/theme/"+e+".css"};0==$("#codemirror-theme-"+r).length?$('<link id="codemirror-theme-'+r+'" >').appendTo("head").attr({type:"text/css",rel:"stylesheet",onload:function(){t&&t(r)},href:o(r)}):t&&t(r)}}function c(c){var u=$('<div id="editor_wrapper"><div id="editor_toc"></div><div id="editor_in"><div id="editor_toolbar"></div><textarea  style="width: 100%; height: 100%"></textarea><div id="editor_stat"></div><div id="editor_innerBar"></div></div><div class="markdown-body" id="editor_out"></div></div>');$("body").append(u),$("body").addClass("editor_noscroll"),this.wrapperElement=u[0],e||($("#editor_in").show(),$("#editor_out").css({visibility:"visible"})),$("#editor_wrapper").animate({scrollLeft:$("#editor_toc").outerWidth()},0),this.eventHandlers=[];var d=a.current(c);d.render();var f=e?"native":"overlay",h=CodeMirror.fromTextArea(document.getElementById("editor_wrapper").querySelector("textarea"),{mode:{name:"gfm"},lineNumbers:!1,matchBrackets:!0,lineWrapping:!0,dragDrop:!0,scrollbarStyle:f,theme:d.editor.theme||"default",styleSelectedText:!0,extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"}}),p=c.turndownService;if(p||(p=new window.TurndownService({headingStyle:"atx",codeBlockStyle:"fenced",defaultReplacement:function(e,t){return t.isBlock?"\n\n"+t.outerHTML+"\n\n":t.outerHTML}})).use(window.turndownPluginGfm.gfm),!1!==c.drop_htmlMarkdownEnable){var m=c.drop_htmlMarkdownHandler||function(e,t,r){return"md"==e?t:"html"==e||"htm"==e?r.turndown(t):void 0};h.setOption("dropContentHandler",function(e,t){var r=e.split(".").pop().toLowerCase();return"md"==r||"html"==r||"htm"==r?m(r,t,p):""})}$("#editor_wrapper").on("DOMSubtreeModified","#custom_css",function(){d.customCss=this.textContent,d.store()}),this.theme=d,this.sync=i.create(h,$("#editor_out")[0],c),this.render=o.create(c,d),this.toolbar=n.create($("#editor_toolbar")[0]);var g=n.create($("#editor_innerBar")[0]);g.hide(),this.innerBar=g;var v,y=this;if(!e){var w,b,k=r(c.render_ms,500);y.eventHandlers.push({name:"remove",handler:function(){w&&clearTimeout(w),b&&clearTimeout(b)}}),h.on("change",function(){if(w&&clearTimeout(w),w=setTimeout(function(){y.doRender(!0)},k),!1!==c.stat_enable){var e=c.stat_formatter||function(e){return"当前字数："+e.getValue().length};$("#editor_stat").html(e(y)).show(),b&&clearTimeout(b),b=setTimeout(function(){$("#editor_stat").hide()},1e3)}});var C=function(){y.doSync()},_=!1!==c.sync_enable;_&&h.on("scroll",C),this.syncEnable=_,this.scrollHandler=C}if(e){function x(e){return!(!t(e)&&null!=e)||!(function(e){var t=window.getComputedStyle(e)["overflow-x"];return("scroll"===t||"auto"===t)&&e.scrollWidth>e.clientWidth}(e)&&$(e).scrollLeft()>0)&&x(e.parentElement)}$("#editor_toc").touchwipe({wipeLeft:function(){y.toEditor()},min_move_x:10,max_move_y:5}),$(h.getScrollerElement()).touchwipe({wipeLeft:function(){y.toPreview()},wipeRight:function(e){y.toToc()},min_move_x:10,max_move_y:5}),$("#editor_out").touchwipe({wipeRight:function(e){x(e.target)&&y.toEditor()},min_move_x:10,max_move_y:5})}if(y.eventHandlers.push({name:"remove",handler:function(){v&&clearTimeout(v)}}),$("#editor_toc").on("click","[data-line]",function(){var t=parseInt($(this).data("line"));h.scrollIntoView({line:t}),v=setTimeout(function(){var r=h.charCoords({line:t,ch:0},"local").top;h.scrollTo(null,r),e&&y.toEditor()},500)}),this.editor=h,this.config=c,function(e){for(var t=e.innerBar,r=e.editor,o=e.config,n=$("#editor_innerBar"),i=o.innerBar_icons||["emoji","heading","bold","italic","quote","strikethrough","link","code","code-block","uncheck","check","table","undo","redo","close"],a=CodeMirror.browser.ios,l=0;l<i.length;l++){var c=i[l];"emoji"==c&&t.addIcon("far fa-grin-alt icon",function(){for(var e=o.emojiArray||$.trim("😀 😁 😂 🤣 😃 😄 😅 😆 😉 😊 😋 😎 😍 😘 😗 😙 😚 ☺️ 🙂 🤗 🤔 😐 😑 😶 🙄 😏 😣 😥 😮 🤐 😯 😪 😫 😴 😌 😛 😜 😝 🤤 😒 😓 😔 😕 🙃 🤑 😲 ☹️ 🙁 😖 😞 😟 😤 😢 😭 😦 😧 😨 😩 😬 😰 😱 😳 😵 😡 😠 😷 🤒 🤕 🤢 🤧 😇 🤠 🤡 🤥 🤓 😈 👿 👹 👺 💀 👻 👽 🤖 💩 😺 😸 😹 😻 😼 😽 🙀 😿 😾").split(" "),t="",n=0;n<e.length;n++)t+='<span data-emoji style="cursor:pointer">'+e[n]+"</span>";swal({html:t}),$(Swal.getContent()).find("[data-emoji]").click(function(){var e=$(this).text(),t=r.getSelection();""==t?r.replaceRange(e,r.getCursor()):r.replaceSelection(e),Swal.close()})}),"heading"==c&&t.addIcon("fas fa-heading icon",function(){!async function(){const{value:e}=await Swal.fire({input:"select",inputValue:"1",inputOptions:{1:"H1",2:"H2",3:"H3",4:"H4",5:"H5",6:"H6"},inputPlaceholder:"",showCancelButton:!0});if(e){for(var t=parseInt(e),o=r.getSelection(),n="\n",i=0;i<t;i++)n+="#";if(n+=" ",""==o){r.replaceRange(n,r.getCursor()),r.focus();var a=r.getCursor(),l=a.line,c=a.ch;r.setCursor({line:l,ch:c+t})}else r.replaceSelection(n+o)}}()}),"bold"==c&&t.addIcon("fas fa-bold icon",function(){var e=r.getSelection();if(""==e){r.replaceRange("****",r.getCursor()),r.focus();var t="**".length,o=r.getCursor(),n=o.line,i=o.ch;r.setCursor({line:n,ch:i-t})}else r.replaceSelection("**"+e+"**")}),"italic"==c&&t.addIcon("fas fa-italic icon",function(){var e=r.getSelection();if(""==e){r.replaceRange("**",r.getCursor()),r.focus();var t="*".length,o=r.getCursor(),n=o.line,i=o.ch;r.setCursor({line:n,ch:i-t})}else r.replaceSelection("*"+e+"*")}),"quote"==c&&t.addIcon("fas fa-quote-left icon",function(){var e=r.getSelection();if(""==e){r.replaceRange("\n> ",r.getCursor()),r.focus();var t=r.getCursor(),o=t.line,n=t.ch;r.setCursor({line:o,ch:n})}else r.replaceSelection("> "+e)}),"strikethrough"==c&&t.addIcon("fas fa-strikethrough icon",function(){var e=r.getSelection();if(""==e){r.replaceRange("~~~~",r.getCursor()),r.focus();var t="~~".length,o=r.getCursor(),n=o.line,i=o.ch;r.setCursor({line:n,ch:i-t})}else r.replaceSelection("~~"+e+"~~")}),"link"==c&&t.addIcon("fas fa-link icon",function(){var e=r.getSelection();if(""==e){r.replaceRange("[](https://)",r.getCursor()),r.focus();var t=r.getCursor(),o=t.line,n=t.ch;r.setCursor({line:o,ch:n-11})}else r.replaceSelection("["+e+"](https://)")}),"code"==c&&t.addIcon("fas fa-code icon",function(){var e=r.getSelection();if(""==e){r.replaceRange("``",r.getCursor()),r.focus();var t=r.getCursor(),o=t.line,n=t.ch;r.setCursor({line:o,ch:n-1})}else r.replaceSelection("`"+e+"`")}),"code-block"==c&&t.addIcon("fas fa-file-code icon",function(){var e="\n```";e+="\n",e+=r.getSelection()+"",e+="\n",e+="```",r.focus(),r.replaceSelection(e),r.setCursor({line:r.getCursor("start").line-1,ch:0})}),"uncheck"==c&&t.addIcon("far fa-square icon",function(){var e=r.getSelection();if(""==e){r.replaceRange("\n- [ ] ",r.getCursor()),r.focus();var t=r.getCursor(),o=t.line,n=t.ch;r.setCursor({line:o,ch:n})}else r.replaceSelection("- [ ] "+e)}),"check"==c&&t.addIcon("far fa-check-square icon",function(){var e=r.getSelection();if(""==e){r.replaceRange("\n- [x] ",r.getCursor()),r.focus();var t=r.getCursor(),o=t.line,n=t.ch;r.setCursor({line:o,ch:n})}else r.replaceSelection("- [x] "+e)}),"undo"==c&&t.addIcon("fas fa-undo icon",function(){r.execCommand("undo")}),"redo"==c&&t.addIcon("fas fa-redo icon",function(){r.execCommand("redo")}),"close"==c&&t.addIcon("fas fa-times icon",function(){t.hide()}),"table"==c&&t.addIcon("fas fa-table icon",function(){t.hide(),swal({html:'<input class="swal2-input" placeholder="行"><input class="swal2-input" placeholder="列">',preConfirm:function(){return new Promise(function(e){var t=$(Swal.getContent()).find("input");e([t.eq(0).val(),t.eq(1).val()])})}}).then(function(e){var o=e.value,n=parseInt(o[0])||3,i=parseInt(o[1])||3;i<1&&(i=3),n<1&&(n=3);for(var a="",l=0;l<=n;l++)a+="|    ";a+="\n";for(var l=0;l<n;l++)a+="|  -  ";if(a+="|",i>1){a+="\n";for(var l=0;l<i-1;l++){for(var c=0;c<=n;c++)a+="|    ";a+="\n"}}r.replaceSelection("\n"+a),t.show()}).catch(swal.noop)})}var s;e.eventHandlers.push({name:"remove",handler:function(){s&&clearInterval(s)}});if(CodeMirror.browser.mobile){var u=function(){var t=!1,r=!1;!1===r&&(r=$(window).width()+$(window).height());var o=function(){if(!a&&!1!==r){var o=$(e.wrapperElement).hasClass("view-withKeyboard"),n=!1,i=Math.abs(r-($(window).width()+$(window).height()));i>100&&(n=!0),$(e.wrapperElement).toggleClass("view-withKeyboard",n),o!=n&&(t=!!n)}};return e.eventHandlers.push({name:"remove",handler:function(){$(window).off("resize orientationchange",o)}}),$(window).on("resize orientationchange",o),{isOpen:t}}();r.on("cursorActivity",function(){!function(e){var t=r.defaultTextHeight(),o=(c=r.cursorCoords(!0,"local").top)-e.height()-2*t;if(o<0)n.css({top:r.cursorCoords(!0).top+2*t+"px"}),e.show();else{var i=r.getScrollerElement(),l=$(i);if(l[0].scrollHeight-l.scrollTop()-l.outerHeight()<0){var c=r.cursorCoords(!0).top-2*t-e.height()-$("#editor_toolbar").height();c>0?(n.css({top:r.cursorCoords(!0).top-2*t-e.height()+"px"}),e.show()):(n.css({top:r.cursorCoords(!0).top+2*t+"px"}),e.show())}else{r.cursorCoords(!0).top;var d=function(){r.scrollTo(0,o),setTimeout(function(){var o=r.cursorCoords(!0).top,i=o>e.height()+2*t;n.css({top:i?o-2*t-e.height()+"px":o+2*t+"px"}),e.show()},50)};a?d():u.isOpen?d():(s&&(waitTime=0,clearInterval(s)),s=setInterval(function(){u.isOpen?(waitTime=0,clearInterval(s),d()):(waitTime+=20,waitTime>=1020&&(waitTime=0,clearInterval(s),d()))},20))}}}(t)}),r.getScrollerElement().addEventListener("touchmove",function(e){t.hide()})}else r.on("cursorActivity",function(){var e,o;e=t,o=r.defaultTextHeight(),n.css({top:r.cursorCoords(!0).top+2*o+"px"}),e.show()}),r.getScrollerElement().addEventListener("touchmove",function(e){t.hide()}),r.on("scroll",function(){t.hide()})}(this),function(e){for(var t,o=e.editor,n=e.theme,i=o,a=e.config,c=function(){function t(t){this.key=t;var o=this;e.editor.on("change",function(){o.autoSaveTimer&&clearTimeout(o.autoSaveTimer),o.autoSaveTimer=setTimeout(function(){o.docName?o.addDocument(o.docName,e.getValue()):o.addDocument("default",e.getValue())},r(a.toolbar_autoSaveMs,500))}),e.eventHandlers.push({name:"remove",handler:function(){o.autoSaveTimer&&clearTimeout(o.autoSaveTimer)}}),e.eventHandlers.push({name:"load",handler:function(){setTimeout(function(){o.loadLastDocument()},100)}})}function o(t,r){null!=r&&("default"!=r.title?t.docName=r.title:t.docName=void 0,e.setValue(r.content),!1!==e.syncEnable&&!1!==a.renderAllDocEnable&&e.editor.renderAllDoc(0))}function n(e,t){for(var r=e.length-1;r>=0;r--)if(e[r].title==t){e.splice(r,1);break}}function i(e,t){var r=JSON.stringify(t);localStorage.setItem(e,r)}return t.prototype.addDocument=function(e,t){var r=this.getDocuments();n(r,e),r.push({title:e,content:t,time:$.now()}),i(this.key,r)},t.prototype.deleteDocument=function(e){var t=this.getDocument(e);null!=t&&this.docName==t.title&&this.newDocument();var r=this.getDocuments();n(r,e),i(this.key,r)},t.prototype.getDocument=function(e){for(var t=this.getDocuments(),r=t.length-1;r>=0;r--)if(t[r].title==e)return t[r];return null},t.prototype.getDocuments=function(){var e=localStorage.getItem(this.key);return null==e?[]:$.parseJSON(e)},t.prototype.getLastDocument=function(){var e=this.getDocuments();return e.sort(function(e,t){var r=e.time,o=t.time;return r>o?-1:r==o?0:1}),e.length>0?e[0]:null},t.prototype.loadLastDocument=function(){var e=this.getLastDocument();o(this,e)},t.prototype.loadDocument=function(e){var t=this.getDocument(e);o(this,t)},t.prototype.newDocument=function(){this.docName=void 0,e.setValue("")},t.prototype.backup=function(){if(this.docName)this.addDocument(this.docName,e.getValue()),this.deleteDocument("default"),swal("保存成功");else{var t=this;!async function(){const{value:r}=await Swal.fire({title:"标题",input:"text",showCancelButton:!0});r&&(t.addDocument(r,e.getValue()),t.docName=r,t.deleteDocument("default"),swal("保存成功"))}()}},{create:function(e){return new t(e)}}}(),s=function(){var r,i=function(e){$(e.target).hasClass("fa-cog")||g(n.toolbar.color,function(e){n.toolbar.color=e,n.render(),n.store()})},c=function(){g(n.stat.color,function(e){n.stat.color=e,n.render(),n.store()})},s=function(){g(n.searchHelper.color,function(e){n.searchHelper.color=e,n.render(),n.store()})},d=function(){g(n.bar.color,function(e){n.bar.color=e,n.render(),n.store()})},f=!1,h=function(){f||async function(){f=!0;const{value:e}=await Swal.fire({input:"select",inputValue:n.editor.theme||"",inputOptions:{"3024-day":"3024-day","3024-night":"3024-night",abcdef:"abcdef","ambiance-mobile":"ambiance-mobile",ambiance:"ambiance","base16-dark":"base16-dark","base16-light":"base16-light",bespin:"bespin",blackboard:"blackboard",cobalt:"cobalt",colorforth:"colorforth",darcula:"darcula",dracula:"dracula","duotone-dark":"duotone-dark","duotone-light":"duotone-light",eclipse:"eclipse",elegant:"elegant","erlang-dark":"erlang-dark","gruvbox-dark":"gruvbox-dark",hopscotch:"hopscotch",icecoder:"icecoder",idea:"idea",isotope:"isotope","lesser-dark":"lesser-dark",liquibyte:"liquibyte",lucario:"lucario",material:"material",mbo:"mbo","mdn-like":"mdn-like",midnight:"midnight",monokai:"monokai",neat:"neat",neo:"neo",night:"night","oceanic-next":"oceanic-next","panda-syntax":"panda-syntax","paraiso-dark":"paraiso-dark","paraiso-light":"paraiso-light","pastel-on-dark":"pastel-on-dark",railscasts:"railscasts",rubyblue:"rubyblue",seti:"seti",shadowfox:"shadowfox",solarized:"solarized",ssms:"ssms","the-matrix":"the-matrix","tomorrow-night-bright":"tomorrow-night-bright","tomorrow-night-eighties":"tomorrow-night-eighties",ttcn:"ttcn",twilight:"twilight","vibrant-ink":"vibrant-ink","xq-dark":"xq-dark","xq-light":"xq-light",yeti:"yeti",zenburn:"zenburn"},inputPlaceholder:"选择主题",showCancelButton:!0});e&&(n.editor.theme=e,n.render(),l(n,function(e){setTimeout(function(){o.setOption("theme",e);var t=window.getComputedStyle(o.getWrapperElement(),null).getPropertyValue("background-color");n.inCss.background=t,n.render(),n.store()},100)}));setTimeout(function(){f=!1},1e3)}()},p=function(){!async function(){const{value:t}=await Swal.fire({input:"select",inputValue:n.mermaid.theme||"",inputOptions:{default:"default",forest:"forest",dark:"dark",neutral:"neutral"},inputPlaceholder:"选择主题",showCancelButton:!0});t&&(n.mermaid.theme=t,n.store(),e.doRender(!1),e.doSync())}()},m=!1;var g=function(e,t){!async function(){const{value:e}=await Swal.fire({html:'<div class="_colorpicker"></div>',showCancelButton:!0})}();var r=$(Swal.getContent()).find("._colorpicker");r.colorpicker({inline:!0,container:!0,template:'<div class="colorpicker"><div class="colorpicker-saturation"><i class="colorpicker-guide"></i></div><div class="colorpicker-hue"><i class="colorpicker-guide"></i></div><div class="colorpicker-alpha">   <div class="colorpicker-alpha-color"></div>   <i class="colorpicker-guide"></i></div></div>'}),e&&r.colorpicker("setValue",e),r.on("colorpickerChange",function(e){e.color&&t&&t(e.color.toString())})};return{toggle:function(){return m?(m=!1,r.off("click",d),r.remove(),$("#editor_searchHelper").off("click",s),$("#editor_searchHelper input").removeAttr("value"),u.hide(),o.off("cursorActivity",h),$("#editor_toolbar").off("click",i),$("#editor_stat").off("click",c),$("#editor_out").off("click",".mermaid",p),$("#editor_stat").text("").hide(),$(".noclick").removeClass("noclick"),o.setOption("readOnly",!1)):(m=!0,n.clone(),$("<link>").appendTo("head").attr({id:"colorpicker-css",type:"text/css",rel:"stylesheet",href:a.res_colorpickerCss||"colorpicker/dist/css/bootstrap-colorpicker.min.css"}),$("<script>").appendTo("body").attr({id:"colorpicker-js",src:a.res_colorpickerJs||"colorpicker/dist/js/bootstrap-colorpicker.min.js"}),o.setOption("readOnly",!0),$("#editor_searchHelper input").attr("value","点击设置字体颜色"),$("#editor_searchHelper").children().addClass("noclick"),u.show(),$("#editor_searchHelper").on("click",s),$("#editor_toolbar").children().addClass("noclick"),$(t).removeClass("noclick"),$("#editor_toolbar").on("click",i),$("#editor_stat").text("点击设置字体颜色").show(),$("#editor_stat").on("click",c),o.on("cursorActivity",h),$("#editor_out").on("click",".mermaid",p),(r=$("#editor_innerBar").clone()).css({visibility:"visible",top:"100px"}),r.children().addClass("noclick"),$("#editor_in").append(r),r.on("click",d)),m},isThemeMode:function(){return m}}}(),u=function(){var t=$('<div id="editor_searchHelper" style="position:absolute;bottom:10px;width:100%;z-index:99;display:none;padding:20px;padding-bottom:5px"><div style="width:100%;text-align:right;margin-bottom:5px"><i class="fas fa-times icon"  style="cursor:pointer;margin-right:0px"></i></div> <form><div class="input-group mb-3"><input type="text" style="border:none" class="form-control" placeholder="查找内容" ><div class="input-group-append" data-search> <span class="input-group-text" ><i class="fas fa-search " style="cursor:pointer"></i></span> </div></div><div class="input-group mb-3" style="display:none"><input type="text" style="border:none" class="form-control" placeholder="替换内容" ><div class="input-group-append" data-replace style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-exchange-alt" ></i></span> </div><div class="input-group-append" data-replace-all style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-sync-alt" ></i></span> </div><div class="input-group-append" data-up style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-arrow-up" ></i></span> </div><div class="input-group-append" data-down style="cursor:pointer"> <span class="input-group-text" ><i class="fas fa-arrow-down" ></i></span> </div></div></form>  </div>');function r(e,t){var r=a();r.query&&i.operation(function(){var n=c(i,r.query,e?r.posFrom:r.posTo);if(n.find(e)||(n=c(i,r.query,e?CodeMirror.Pos(i.lastLine()):CodeMirror.Pos(i.firstLine(),0))).find(e)){i.setSelection(n.from(),n.to());for(var a=o.getAllMarks(),l=0;l<a.length;l++)a[l].clear();o.markText(n.from(),n.to(),{className:"styled-background"});var s=i.cursorCoords(n.from(),"local");i.scrollTo(0,s.top),r.posFrom=n.from(),r.posTo=n.to(),t&&t({from:n.from(),to:n.to()})}else t&&t(null)})}function n(){for(var t=o.getAllMarks(),r=0;r<t.length;r++)t[r].clear();e.editor.operation(function(){var t=a();t.lastQuery=t.query,t.query&&(t.query=t.queryText=null,e.editor.removeOverlay(t.overlay),t.annotate&&(t.annotate.clear(),t.annotate=null))})}function a(){return e.editor.state.search||(e.editor.state.search=new s)}function l(e){return"string"==typeof e&&e==e.toLowerCase()}function c(e,t,r){return e.getSearchCursor(t,r,{caseFold:l(t),multiline:!0})}function s(){this.posFrom=this.posTo=this.lastQuery=this.query=null,this.overlay=null}return $("#editor_in").append(t),t.on("click","[data-search]",function(){!function(e){n();var o=a(),c=t.find("input").eq(0).val();if(""==$.trim(c))return void swal("搜索内容不能为空");o.queryText=c,o.query=function(e){if(""==e)return e;var t=e.match(/^\/(.*)\/([a-z]*)$/);if(t)try{e=new RegExp(t[1],-1==t[2].indexOf("i")?"":"i")}catch(e){}else e=e.replace(/\\([nrt\\])/g,function(e,t){return"n"==t?"\n":"r"==t?"\r":"t"==t?"\t":"\\"==t?"\\":e});("string"==typeof e?""==e:e.test(""))&&(e=/x^/);return e}(c),i.removeOverlay(o.overlay,l(o.query)),r(!1,e)}(function(e){null==e?swal("没有找到符合条件的搜索内容"):(t.find(".input-group").eq(0).hide(),t.find(".input-group").eq(1).show())})}),t.on("click",".fa-times",function(){n(),t.hide(),t.find("input").val(""),t.find(".input-group").eq(0).show(),t.find(".input-group").eq(1).hide(),o.setOption("readOnly",!1)}),t.on("click","[data-down]",function(){r(!1)}),t.on("click","[data-up]",function(){r(!0)}),t.on("click","[data-replace]",function(){var e=t.find("input").eq(1).val(),r=a();if(r.query){var o=c(i,r.query,i.getCursor("from"));!function(){var t=o.from();if(!o.findNext()&&(o=c(i,r.query),!o.findNext()||t&&o.from().line==t.line&&o.from().ch==t.ch))return;i.setSelection(o.from(),o.to());var n=i.cursorCoords(o.from(),"local");i.scrollTo(0,n.top),o.replace("string"==typeof query?e:e.replace(/\$(\d)/g,function(e,t){}))}()}}),t.on("click","[data-replace-all]",function(){Swal.fire({title:"确定要替换全部吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(e=>{if(e.value){var r=t.find("input").eq(1).val(),o=a();if(!o.query)return;query=o.query,i.operation(function(){for(var e=c(i,query);e.findNext();)if("string"!=typeof query){var t=i.getRange(e.from(),e.to()).match(query);e.replace(r.replace(/\$(\d)/g,function(e,r){return t[r]}))}else e.replace(r)})}})}),{show:function(){t.show()},hide:function(){t.hide()}}}(),d=a.toolbar_icons||["toc","innerBar","backup","search","config","expand"],f=0;f<d.length;f++){var h=d[f];if("toc"==h&&e.toolbar.addIcon("fas fa-book icon mobile-hide nofullscreen",function(){g()}),"innerBar"==h&&(e.innerBar.keepHidden=!0,e.innerBar.hide(),e.toolbar.addIcon("far icon fa-square",function(e){y(e)})),"search"==h&&e.toolbar.addIcon("fas fa-search icon",function(){o.setOption("readOnly",!0),u.show()}),"backup"==h){var p=c.create("markdown-documents");e.toolbar.addIcon("fas icon fa-upload ",function(e){p.backup()}),e.toolbar.addIcon("fas icon fa-download ",function(e){w(p)}),e.toolbar.addIcon("far fa-file icon nofullscreen",function(e){b(p)}),e.backup=p}"config"==h&&e.toolbar.addIcon("fas icon fa-cog nofullscreen",function(){swal({html:'<input type="checkbox"  />主题编辑模式 <p style="margin-top:0.5rem"><button style="margin-bottom:0.5rem;border: 0;border-radius: .25em;background: initial;background-color: #3085d6;color: #fff;font-size: 1.0625em;margin: .3125em;padding: .625em 2em;font-weight: 500;box-shadow: none;">自定义css</button></p>'});var e=$(Swal.getContent().querySelector("input"));e.prop("checked",s.isThemeMode),e.change(function(){s.toggle()}),$(Swal.getContent().querySelector("button")).click(function(){k()})},function(e){t=e}),"expand"==h&&e.toolbar.addIcon("fas fa-expand icon mobile-hide",function(t){$(t).hasClass("fa-expand")?e.requestFullScreen():e.exitFullScreen()},function(t){if(screenfull.enabled){var r=function(){screenfull.isFullscreen?$(t).removeClass("fa-expand").addClass("fa-compress"):$(t).removeClass("fa-compress").addClass("fa-expand")};e.eventHandlers.push({name:"remove",handler:function(){screenfull.off("change",r)}}),screenfull.on("change",r)}})}var m=!1;function g(){m?e.toEditor(function(){m=!1}):e.toToc(function(){m=!0})}var v=e.innerBar;function y(e){v.keepHidden=!v.keepHidden,v.keepHidden?(v.hide(),$(e).addClass("fa-square").removeClass("fa-check-square")):$(e).addClass("fa-check-square").removeClass("fa-square")}function w(e){for(var t=e.getDocuments(),r=t.length-1;r>=0;r--)if("default"==t[r].title){t.splice(r,1);break}if(0==t.length)swal("没有保存的文档");else{for(var o='<table class="table">',r=0;r<t.length;r++){var n=t[r];o+="<tr><td>"+n.title+'</td><td><i class="fas fa-times" data-title="'+n.title+'" style="margin-right:20px;cursor:pointer"></i><i data-title="'+n.title+'" class="fas fa-arrow-down" style=";cursor:pointer"></i></td><tr>'}o+="</table>",swal({html:o}),$(Swal.getContent()).find(".fa-times").click(function(){var t=$(this).data("title");Swal.fire({title:"确定要删除吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(r=>{r.value&&(e.deleteDocument(t),w(e))})}),$(Swal.getContent()).find(".fa-arrow-down").click(function(){var t=$(this).data("title");Swal.fire({title:"确定要加载吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(r=>{r.value&&e.loadDocument(t)})})}}function b(e){Swal.fire({title:"要打开一篇新文档吗?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"}).then(t=>{t.value&&e.newDocument()})}function k(){!async function(){const{value:e}=await Swal.fire({input:"textarea",inputPlaceholder:"css",inputValue:n.customCss||"",showCancelButton:!0});e&&(n.customCss=e,n.render(),n.store())}()}}(this),this.fullscreen=!1,screenfull.enabled){var S=function(){y.fullscreen=screenfull.isFullscreen,function(e,t){if(!CodeMirror.browser.mobile){var r=e.editor,o=r.getWrapperElement();if(t)$(e.getFullScreenElement()).addClass("editor_fullscreen"),r.state.fullScreenRestore={scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,width:o.style.width,height:o.style.height},o.style.width="",o.style.height="auto",o.className+=" CodeMirror-fullscreen",document.documentElement.style.overflow="hidden",r.refresh();else{$(e.getFullScreenElement()).removeClass("editor_fullscreen"),o.className=o.className.replace(/\s*CodeMirror-fullscreen\b/,""),document.documentElement.style.overflow="";var n=r.state.fullScreenRestore;o.style.width=n.width,o.style.height=n.height,window.scrollTo(n.scrollLeft,n.scrollTop),r.refresh()}}}(y,screenfull.isFullscreen),screenfull.isFullscreen||(y.toEditor(void 0,0),y.doSync())};y.eventHandlers.push({name:"remove",handler:function(){screenfull.off("change",S)}}),screenfull.on("change",S)}s(this,"load")}function s(e,t,r){for(var o=0;o<e.eventHandlers.length;o++){var n=e.eventHandlers[o];if(n.name==t)try{n.handler.call(this,r)}catch(e){}}}c.prototype.doRender=function(e){this.render.renderAt(this.editor.getValue(),$("#editor_out")[0],e),function(){for(var e=document.getElementById("editor_out").querySelectorAll("h1, h2, h3, h4, h5, h6"),t=[],r=0;r<e.length;r++){var o=e[r],n=o.tagName.substring(1),i=o.getAttribute("data-line");if(0==t.length)t.push([{indent:n,name:o.textContent,line:i}]);else{var a=t[t.length-1],l=a[0];n>l.indent?a.push({indent:n,name:o.textContent,line:i}):t.push([{indent:n,name:o.textContent,line:i}])}}var c="<h1>TOC</h1><hr>";if(t.length>0)for(var r=0;r<t.length;r++)for(var s=t[r],u=0;u<s.length;u++){var d=s[u],f=d.indent;c+="<h"+f+' data-line="'+d.line+'">'+d.name+"</h"+f+">"}try{var h=document.createElement("div");h.setAttribute("id","editor_toc"),h.innerHTML=c,morphdom($("#editor_toc")[0],h)}catch(e){$("#editor_toc").html(c)}}()},c.prototype.remove=function(e){s(this,"remove"),$(this.getFullScreenElement()).removeClass("fullscreen"),$("body").removeClass("editor_noscroll"),this.wrapperElement.parentNode.removeChild(this.wrapperElement),u.wrapper=void 0,delete u.wrapper},c.prototype.doSync=function(){this.sync.doSync()},c.prototype.requestFullScreen=function(){e||(screenfull.enabled?screenfull.request(this.getFullScreenElement()):swal("当前浏览器不支持全屏模式"))},c.prototype.getFullScreenElement=function(){return document.body},c.prototype.exitFullScreen=function(){!e&&screenfull.enabled&&screenfull.exit()},c.prototype.enableSync=function(){this.syncEnable||(editor.on("scroll",this.scrollHandler),this.syncEnable=!0)},c.prototype.getHtml=function(){return this.render.getHtml(this.editor.getValue())},c.prototype.getValue=function(){return this.editor.getValue()},c.prototype.setValue=function(e){return this.editor.setValue(e)},c.prototype.disableSync=function(){this.syncEnable&&(editor.off("scroll",this.scrollHandler),this.syncEnable=!1)},c.prototype.toEditor=function(t,o){var n=r(o,r(this.config.swipe_animateMs,500));e?$("#editor_wrapper").animate({scrollLeft:$("#editor_in").width()},n,function(){t&&t()}):$("#editor_wrapper").animate({scrollLeft:$("#editor_in").offset().left},n,function(){t&&t()})},c.prototype.toToc=function(t,o){this.editor.getInputField().blur(),e&&this.doRender(!0);var n=r(o,r(this.config.swipe_animateMs,500));$("#editor_wrapper").animate({scrollLeft:0},n,function(){t&&t()})},c.prototype.toPreview=function(t,o){if(e){this.editor.getInputField().blur(),this.doRender(!0),this.doSync();var n=r(o,r(this.config.swipe_animateMs,500));$("#editor_wrapper").animate({scrollLeft:$("#editor_out")[0].offsetLeft},n,function(){t&&t()})}};var u={};return{create:function(e){return u.wrapper&&u.wrapper.remove(),u.wrapper=new c(e),u.wrapper}}}()}();
